package components

import (
	"github.com/mbvisti/mortenvistisen/router/contexts"
	"github.com/dromara/carbon/v2"
)

templ toastBase(tType string, flash contexts.FlashMessage) {
	<div
		x-data="{ show: true }"
		x-show="show"
		x-transition:leave="transition ease-in duration-300"
		x-transition:leave-start="opacity-100 scale-100"
		x-transition:leave-end="opacity-0 scale-90"
		x-init="setTimeout(() => $el.remove(), 8000)"
		class="bg-base-300 rounded border border-white/50 flex flex-col"
	>
		<div
			class="px-4 py-2 flex items-center justify-between border-b-1 border-white/50"
		>
			<div
				class={ "rounded w-3 h-3", tType }
			></div>
			<div
				class="flex"
			>
				<p
					class="text-gray-400 text-sm"
				>{ carbon.CreateFromStdTime(flash.CreatedAt, carbon.Berlin).DiffForHumans() }</p>
				<button
					@click="show = false"
					class="ml-4 w-5 h-5 cursor-pointer"
					type="button"
				>
					<svg class="fill-white" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 24 24">
						<path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"></path>
					</svg>
				</button>
			</div>
		</div>
		<span class="max-h-40 p-4 text-wrap max-w-96 overflow-x-hidden overflow-y-scroll">
			{ flash.Message }
		</span>
	</div>
}

templ ToastMessage(flash contexts.FlashMessage) {
	switch flash.Type {
		case contexts.FlashSuccess:
			@toastBase("bg-success", flash)
		case contexts.FlashInfo:
			@toastBase("bg-info", flash)
		case contexts.FlashError:
			@toastBase("bg-error", flash)
		case contexts.FlashWarning:
			@toastBase("bg-warning", flash)
	}
}
